var IO=IO||{};!function(){var swfobject=function(){var l,Q,E,B,n,G,D="undefined",r="object",S="Shockwave Flash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=!1,U=[function(){(T?function(){var X=j.getElementsByTagName("body")[0],aa=C(r);aa.setAttribute("type",q);var Y,Z=X.appendChild(aa);Z?(Y=0,function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");ab&&(ab=ab.split(" ")[1].split(","),M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)])}else if(Y<10)return Y++,setTimeout(arguments.callee,10);X.removeChild(aa),Z=null,H()}()):H()}:H)()}],o=[],N=[],I=[],J=!1,a=!1,m=!0,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,af=t.userAgent.toLowerCase(),ac=t.platform.toLowerCase(),ae=/win/.test(ac||af),ac=/mac/.test(ac||af),af=!!/webkit/.test(af)&&parseFloat(af.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),X=!1,ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r)!(ab=t.plugins[S].description)||typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin||(X=!(T=!0),ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10),ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10),ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof O.ActiveXObject!=D)try{var ad=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");ad&&(ab=ad.GetVariable("$version"))&&(X=!0,ab=ab.split(" ")[1].split(","),ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)])}catch(Z){}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}();M.w3&&((typeof j.readyState!=D&&"complete"==j.readyState||typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))&&f(),J||(typeof j.addEventListener!=D&&j.addEventListener("DOMContentLoaded",f,!1),M.ie&&M.win&&(j.attachEvent(x,function(){"complete"==j.readyState&&(j.detachEvent(x,arguments.callee),f())}),O==top&&function(){if(!J){try{j.documentElement.doScroll("left")}catch(X){return setTimeout(arguments.callee,0)}f()}}()),M.wk&&function(){J||(/loaded|complete/.test(j.readyState)?f():setTimeout(arguments.callee,0))}(),s(f)));function f(){if(!J){try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=!0;for(var X=U.length,Y=0;Y<X;Y++)U[Y]()}}function K(X){J?X():U[U.length]=X}function s(Y){var X;typeof O.addEventListener!=D?O.addEventListener("load",Y,!1):typeof j.addEventListener!=D?j.addEventListener("load",Y,!1):typeof O.attachEvent!=D?function(Z,X,Y){Z.attachEvent(X,Y),I[I.length]=[Z,X,Y]}(O,"onload",Y):"function"==typeof O.onload?(X=O.onload,O.onload=function(){X(),Y()}):O.onload=Y}function H(){var ag=o.length;if(0<ag)for(var af=0;af<ag;af++){var Z=o[af].id,ab=o[af].callbackFn,aa={success:!1,id:Z};if(0<M.pv[0]){var ae=c(Z);if(ae)if(!F(o[af].swfVersion)||M.wk&&M.wk<312)if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall,ai.width=ae.getAttribute("width")||"0",ai.height=ae.getAttribute("height")||"0",ae.getAttribute("class")&&(ai.styleclass=ae.getAttribute("class")),ae.getAttribute("align")&&(ai.align=ae.getAttribute("align"));for(var ah={},X=ae.getElementsByTagName("param"),ac=X.length,ad=0;ad<ac;ad++)"movie"!=X[ad].getAttribute("name").toLowerCase()&&(ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value"));P(ai,ah,Z,ab)}else!function(Y){var X;M.ie&&M.win&&4!=Y.readyState?(X=C("div"),Y.parentNode.insertBefore(X,Y),X.parentNode.replaceChild(g(Y),X),Y.style.display="none",function(){4==Y.readyState?Y.parentNode.removeChild(Y):setTimeout(arguments.callee,10)}()):Y.parentNode.replaceChild(g(Y),Y)}(ae),ab&&ab(aa);else w(Z,!0),ab&&(aa.success=!0,aa.ref=z(Z),ab(aa))}else w(Z,!0),ab&&((Z=z(Z))&&typeof Z.SetVariable!=D&&(aa.success=!0,aa.ref=Z),ab(aa))}}function z(Z){var X=null,Z=c(Z);return Z&&"OBJECT"==Z.nodeName&&(typeof Z.SetVariable!=D?X=Z:(Z=Z.getElementsByTagName(r)[0])&&(X=Z)),X}function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Y){E=Y||null,B={success:!(a=!0),id:X};var ae=c(X);ae&&(Q="OBJECT"==ae.nodeName?(l=g(ae),null):(l=ae,X),aa.id=R,(typeof aa.width==D||!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)&&(aa.width="310"),(typeof aa.height==D||!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)&&(aa.height="137"),j.title=j.title.slice(0,47)+" - Flash Player Installation",Y=M.ie&&M.win?"ActiveX":"PlugIn",Y="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+Y+"&MMdoctitle="+j.title,typeof ab.flashvars!=D?ab.flashvars+="&"+Y:ab.flashvars=Y,M.ie&&M.win&&4!=ae.readyState&&(X+="SWFObjectNew",(Y=C("div")).setAttribute("id",X),ae.parentNode.insertBefore(Y,ae),ae.style.display="none",function(){4==ae.readyState?ae.parentNode.removeChild(ae):setTimeout(arguments.callee,10)}()),u(aa,ab,X))}function g(Y){var aa=C("div");if(M.win&&M.ie)aa.innerHTML=Y.innerHTML;else{Y=Y.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad)for(var X=ad.length,Z=0;Z<X;Z++)1==ad[Z].nodeType&&"PARAM"==ad[Z].nodeName||8==ad[Z].nodeType||aa.appendChild(ad[Z].cloneNode(!0))}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312)return X;if(aa)if(typeof ai.id==D&&(ai.id=Y),M.ie&&M.win){var ae,ah="";for(ae in ai)ai[ae]!=Object.prototype[ae]&&("data"==ae.toLowerCase()?ag.movie=ai[ae]:"styleclass"==ae.toLowerCase()?ah+=' class="'+ai[ae]+'"':"classid"!=ae.toLowerCase()&&(ah+=" "+ae+'="'+ai[ae]+'"'));var ad,af="";for(ad in ag)ag[ad]!=Object.prototype[ad]&&(af+='<param name="'+ad+'" value="'+ag[ad]+'" />');aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>",N[N.length]=ai.id,X=c(ai.id)}else{var ac,ab,Z=C(r);for(ac in Z.setAttribute("type",q),ai)ai[ac]!=Object.prototype[ac]&&("styleclass"==ac.toLowerCase()?Z.setAttribute("class",ai[ac]):"classid"!=ac.toLowerCase()&&Z.setAttribute(ac,ai[ac]));for(ab in ag)ag[ab]!=Object.prototype[ab]&&"movie"!=ab.toLowerCase()&&function(Z,X,Y){var aa=C("param");aa.setAttribute("name",X),aa.setAttribute("value",Y),Z.appendChild(aa)}(Z,ab,ag[ab]);aa.parentNode.replaceChild(Z,aa),X=Z}return X}function y(Y){var X=c(Y);X&&"OBJECT"==X.nodeName&&(M.ie&&M.win?(X.style.display="none",function(){4==X.readyState?function(Z){var Y=c(Z);if(Y){for(var X in Y)"function"==typeof Y[X]&&(Y[X]=null);Y.parentNode.removeChild(Y)}}(Y):setTimeout(arguments.callee,10)}()):X.parentNode.removeChild(X))}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function F(X){var Y=M.pv,X=X.split(".");return X[0]=parseInt(X[0],10),X[1]=parseInt(X[1],10)||0,X[2]=parseInt(X[2],10)||0,Y[0]>X[0]||Y[0]==X[0]&&Y[1]>X[1]||Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]}function v(ac,Y,X,Z){var aa;M.ie&&M.mac||(aa=j.getElementsByTagName("head")[0])&&(X=X&&"string"==typeof X?X:"screen",Z&&(G=n=null),n&&G==X||((Z=C("style")).setAttribute("type","text/css"),Z.setAttribute("media",X),n=aa.appendChild(Z),M.ie&&M.win&&typeof j.styleSheets!=D&&0<j.styleSheets.length&&(n=j.styleSheets[j.styleSheets.length-1]),G=X),M.ie&&M.win?n&&typeof n.addRule==r&&n.addRule(ac,Y):n&&typeof j.createTextNode!=D&&n.appendChild(j.createTextNode(ac+" {"+Y+"}")))}function w(Z,Y){m&&(Y=Y?"visible":"hidden",J&&c(Z)?c(Z).style.visibility=Y:v("#"+Z,"visibility:"+Y))}function L(Y){return null!=/[\\\"<>\.;]/.exec(Y)&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}M.ie&&M.win&&window.attachEvent("onunload",function(){for(var ac=I.length,ab=0;ab<ac;ab++)I[ab][0].detachEvent(I[ab][1],I[ab][2]);for(var Y,X,Z=N.length,aa=0;aa<Z;aa++)y(N[aa]);for(Y in M)M[Y]=null;for(X in M=null,swfobject)swfobject[X]=null;swfobject=null});return{registerObject:function(ab,X,aa,Z){var Y;M.w3&&ab&&X?((Y={}).id=ab,Y.swfVersion=X,Y.expressInstall=aa,Y.callbackFn=Z,o[o.length]=Y,w(ab,!1)):Z&&Z({success:!1,id:ab})},getObjectById:function(X){if(M.w3)return z(X)},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:!1,id:ah};M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y?(w(ah,!1),K(function(){ae+="",ag+="";var aj={};if(af&&typeof af===r)for(var al in af)aj[al]=af[al];aj.data=ab,aj.width=ae,aj.height=ag;var am={};if(ad&&typeof ad===r)for(var ak in ad)am[ak]=ad[ak];if(Z&&typeof Z===r)for(var ai in Z)typeof am.flashvars!=D?am.flashvars+="&"+ai+"="+Z[ai]:am.flashvars=ai+"="+Z[ai];if(F(Y)){var an=u(aj,am,ah);aj.id==ah&&w(ah,!0),X.success=!0,X.ref=an}else{if(aa&&A())return aj.data=aa,void P(aj,am,ah,ac);w(ah,!0)}ac&&ac(X)})):ac&&ac(X)},switchOffAutoHideShow:function(){m=!1},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3)return u(Z,Y,X)},showExpressInstall:function(Z,aa,X,Y){M.w3&&A()&&P(Z,aa,X,Y)},removeSWF:function(X){M.w3&&y(X)},createCSS:function(aa,Z,Y,X){M.w3&&v(aa,Z,Y,X)},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)&&(Z=Z.split("?")[1]),null==aa)return L(Z);for(var Y=Z.split("&"),X=0;X<Y.length;X++)if(Y[X].substring(0,Y[X].indexOf("="))==aa)return L(Y[X].substring(Y[X].indexOf("=")+1))}return""},expressInstallCallback:function(){var X;a&&((X=c(R))&&l&&(X.parentNode.replaceChild(l,X),Q&&(w(Q,!0),M.ie&&M.win&&(l.style.display="block")),E&&E(B)),a=!1)}}}();function escapeRegExp(str){return str.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")}var Cookie={get:function(value){value=document.cookie.match("(?:^|;)\\s*"+escapeRegExp(value)+"=([^;]*)");return value&&value[1]||""},set:function(key,value,secure){secure=secure||{},null===value&&(value="",secure.expires=-1);var expires="";secure.expires&&(+secure.expires||secure.expires.toUTCString)&&(+secure.expires?(domain=new Date).setTime(domain.getTime()+1e3*secure.expires):domain=secure.expires,expires="; expires="+domain.toUTCString());var path=secure.path?"; path="+secure.path:"",domain=secure.domain?"; domain="+secure.domain:"",secure=secure.secure?"; secure":"";document.cookie=[key,"=",value,expires,path,domain,secure].join("")}},_sslM=new function(){var _isSSL=!1;0==location.protocol.indexOf("https:")&&(_isSSL=!0),this.SSL_SWF_URL="https://current.sina.com.cn/theone/SwfWebSocket.swf",this.get=function(){return _isSSL}};function JsLoadHqM(o_){o_=merge({ssl:!1,host:"hq.sinajs.cn"},o_||{}),_sslM.get()&&(o_.ssl=!0);var _lastMode,protocal=o_.ssl?"https":"http",_urlEtag=protocal+"://"+o_.host+"/etag.php?rn=$rand@type@@others@&list=".replace("$rand",String((new Date).getTime())),_urlNoEtag=protocal+"://"+o_.host+"/?rn=$rand@type@@others@&list=",_url="",_COOKIE_KEY="hqEtagMode",_domain="",_cookieOption={domain:_domain,path:"/",expires:600},_TRY_LIMIT=2;function _checkEtagAvailability(){Cookie.set(_COOKIE_KEY,"-1",{domain:_domain,path:"/",expires:10});var _time,_failNum,tryTimes,_checkTime=-1,_checkIp=-1;function _checkFinal(){if(0===_checkTime&&0===_checkIp)_url=_urlEtag,Cookie.set(_COOKIE_KEY,"0",_cookieOption);else{if(1!==_checkTime&&1!==_checkIp)return;_url=_urlNoEtag;var mode=(0!==_checkTime?1:0)+(0!==_checkIp?2:0);Cookie.set(_COOKIE_KEY,mode,_cookieOption)}tellMode()}tryTimes=_failNum=0,function _l(){getScript(protocal+"://"+o_.host+"/list=sys_hqEtagMode",function(){var sys_hqEtagMode=window.hq_str_sys_hqEtagMode;if(void 0===_time)_time=sys_hqEtagMode;else{if(_time==sys_hqEtagMode&&_failNum++,_TRY_LIMIT<=++tryTimes)return _checkTime=_failNum?1:0,void _checkFinal();_time=sys_hqEtagMode}setTimeout(_l,2e3)})}(),o_.ssl?(_checkIp=0,_checkFinal()):getScript(protocal+"://"+o_.host+"/list=sys_clientip,sys_serverip",function(){var clientIp_domain=window.hq_str_sys_clientip,serverIp=window.hq_str_sys_serverip;getScript([protocal,"://",serverIp,"/?list=sys_clientip"].join(""),function(){var clientIp_ip=window.hq_str_sys_clientip;_checkIp=clientIp_domain==clientIp_ip?0:1,_checkFinal()})})}function _checkEtagMode(){switch(Cookie.get(_COOKIE_KEY)){case"0":_url=_urlEtag,tellMode();break;case"1":case"2":case"3":_url=_urlNoEtag,tellMode();break;case"-1":_url=_urlEtag;break;default:_url=_urlEtag,_checkEtagAvailability()}}var eventListeners={mode:[]};function tellMode(){var mode=Cookie.get(_COOKIE_KEY);if(_lastMode!==mode){for(var i=0,l=eventListeners.mode.length;i<l;i++)eventListeners.mode[i](mode);_lastMode=mode}}function fn(list,callBack,option){option=option||{},getScript(_url.replace("$rand",String((new Date).getTime())).replace("@type@",option.type?"&format="+option.type:"").replace("@others@",option.others||"")+list,callBack,option.charset)}return fn.addEventListener=function(type,fn){(eventListeners[type]||(eventListeners[type]=[])).push(fn),void 0!==_lastMode&&fn(_lastMode)},_checkEtagMode(),setInterval(_checkEtagMode,1e3),fn}function checkNative(){return!("function"!=typeof WebSocket&&"object"!=typeof WebSocket||WebSocket.isNotNative||/version\/5[\s\S]*safari/i.test(navigator.userAgent))}var _PHP_UA_VAR="httpheaderuavons",__phpUA=void 0;WEB_SOCKET_SWF_LOCATION=window.WEB_SOCKET_SWF_LOCATION||"https://current.sina.com.cn/theone/SwfWebSocket.swf",checkNative()||function(){var logger=window.WEB_SOCKET_LOGGER?WEB_SOCKET_LOGGER:window.console&&window.console.log&&window.console.error?window.console:{log:function(){},error:function(){}};if(swfobject.getFlashPlayerVersion().major<10)return logger.error("Flash Player >= 10.0.0 is required."),window.WebSocket=window.WebSocket||{},window.WebSocket.canUse=!1,window.WebSocket.isNotNative=!0;"file:"==location.protocol&&logger.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),window.WebSocket=function(url,protocols,proxyHost,proxyPort,headers){var self=this;self.__id=WebSocket.__nextId++,(WebSocket.__instances[self.__id]=self).readyState=WebSocket.CONNECTING,self.bufferedAmount=0,self.__events={},protocols?"string"==typeof protocols&&(protocols=[protocols]):protocols=[],self.__createTask=setTimeout(function(){WebSocket.__addTask(function(){self.__createTask=null,WebSocket.__flash.create(self.__id,url,protocols,proxyHost||null,proxyPort||0,headers||null)})},0)},window.WebSocket.isNotNative=!0,WebSocket.prototype.send=function(result){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";result=WebSocket.__flash.send(this.__id,encodeURIComponent(result));return result<0||(this.bufferedAmount+=result,!1)},WebSocket.prototype.initFlashLC=function(key,id){WebSocket.__flash.init(key,id)},WebSocket.prototype.close=function(){if(this.__createTask)return clearTimeout(this.__createTask),this.__createTask=null,void(this.readyState=WebSocket.CLOSED);this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(type,listener,useCapture){type in this.__events||(this.__events[type]=[]),this.__events[type].push(listener)},WebSocket.prototype.removeEventListener=function(type,listener,useCapture){if(type in this.__events)for(var events=this.__events[type],i=events.length-1;0<=i;--i)if(events[i]===listener){events.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(event){for(var events=this.__events[event.type]||[],i=0;i<events.length;++i)events[i](event);var handler=this["on"+event.type];handler&&handler.apply(this,[event])},WebSocket.prototype.__handleEvent=function(data){if("readyState"in data&&(this.readyState=data.readyState),"protocol"in data&&(this.protocol=data.protocol),"open"==data.type||"error"==data.type)jsEvent=this.__createSimpleEvent(data.type);else if("close"==data.type)(jsEvent=this.__createSimpleEvent("close")).wasClean=!!data.wasClean,jsEvent.code=data.code,jsEvent.reason=data.reason;else{if("message"!=data.type)throw"unknown event type: "+data.type;var data=decodeURIComponent(data.message),jsEvent=this.__createMessageEvent("message",data)}this.dispatchEvent(jsEvent)},WebSocket.prototype.__createSimpleEvent=function(type){if(document.createEvent&&window.Event){var event=document.createEvent("Event");return event.initEvent(type,!1,!1),event}return{type:type,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(type,data){if(document.createEvent&&window.MessageEvent&&!window.opera){var event=document.createEvent("MessageEvent");return!event.initMessageEvent&&event.initEvent?event=new MessageEvent("message",{view:window,bubbles:!1,cancelable:!1,data:data}):event.initMessageEvent("message",!1,!1,data,null,null,window,null),event}return{type:type,data:data,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__isFlashImplementation=!0,WebSocket.__initialized=!1,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(url){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(url)})},WebSocket.canUse=!0,WebSocket.__initialize=function(){var holder,swfUrl;WebSocket.__initialized||(WebSocket.__initialized=!0,WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION?(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR||WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)||WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/),(swfUrl=document.createElement("div")).id="webSocketContainer",swfUrl.style.position="absolute",WebSocket.__isFlashLite()?(swfUrl.style.left="0px",swfUrl.style.top="0px"):(swfUrl.style.left="-100px",swfUrl.style.top="-100px"),(holder=document.createElement("div")).id="webSocketFlash",swfUrl.appendChild(holder),document.body.insertBefore(swfUrl,document.body.childNodes[0]),swfUrl=WEB_SOCKET_SWF_LOCATION,_sslM.get()&&0!=swfUrl.indexOf("https:")&&(swfUrl=_sslM.SSL_SWF_URL,WEB_SOCKET_SWF_LOCATION=swfUrl),swfobject.embedSWF(swfUrl,"webSocketFlash","1","1","10.0.0",null,{},{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(e){e.success||(WebSocket.canUse=!1,logger.error("[WebSocket] swfobject.embedSWF failed"))})):logger.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf"))},WebSocket.flashOK=!1,WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.flashOK=!0,WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var i=0;i<WebSocket.__tasks.length;++i)WebSocket.__tasks[i]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var events=WebSocket.__flash.receiveEvents(),i=0;i<events.length;++i)WebSocket.__instances[events[i].webSocketId].__handleEvent(events[i])}catch(e){logger.error(e)}},0),!0},WebSocket.__log=function(message){},WebSocket.__error=function(message){logger.error(decodeURIComponent(message))},WebSocket.__addTask=function(task){WebSocket.__flash?task():WebSocket.__tasks.push(task)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var mimeType=window.navigator.mimeTypes["application/x-shockwave-flash"];return!!(mimeType&&mimeType.enabledPlugin&&mimeType.enabledPlugin.filename)&&!!mimeType.enabledPlugin.filename.match(/flashlite/i)},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||swfobject.addDomLoadEvent(function(){WebSocket.__initialize()})}();var isFunc=isType("Function"),isBlob=isType("Blob"),isStr=isType("String"),hasLs=function(){if("object"==typeof localStorage&&localStorage&&localStorage.setItem){var testStr="KKE_LOCALSTORAGE_TESTing";try{return localStorage.removeItem(testStr),localStorage.setItem(testStr,testStr),localStorage.removeItem(testStr),!0}catch(e){return!1}}return!1}(),_iframeID,_iframe,_pWin,proxy;function AuthMgr(ws_,tmpO_){tmpO_=tmpO_||{};function _stop(){clearInterval(void 0)}function _authDone(timeout_){isFunc(_callback)&&(_callback.apply(ws_),_callback=null),_isTmp||ws_.setReTimeout(timeout_)}function _onErr(obj_){ws_.close(),_stop(),_authCfg.onerr(obj_),_authCfg.ondebug("exception occurred while authoring:"+obj_.result)}function _updateToken(token_){if(_curToken=token_,_authCfg.ondebug("got new token"),!_isTmp){var v=[_curToken,"x"].join("|KKE|");if(hasLs)try{localStorage.setItem(_tokenStorageKey,v)}catch(e){localStorage.removeItem(_tokenStorageKey),localStorage.setItem(_tokenStorageKey,v)}}}function _loadLocalToken(){var str,offset,savedToken;_authCfg.ondebug("checking local token..."),hasLs&&(str=localStorage.getItem(_tokenStorageKey)||null,savedToken=null,str?(str=(offset=str.split("|KKE|"))[0],offset=+offset[1],_authCfg.ondebug("checking local token time:"+offset),!str||str.length<9||isNaN(offset)?_authCfg.ondebug("unexpected local token"):(offset=(new Date).getTime()-offset)<18e4?savedToken={token:str,timeout:18e4-offset}:_authCfg.ondebug("local token is expired")):_authCfg.ondebug("local token does not exist"),savedToken=savedToken),savedToken?(_authCfg.ondebug("use local token"),_curToken=savedToken.token,_authDone(savedToken.timeout)):_onlineAuth()}var _callback,_client_ip,_authCfg=ws_.cfg,_authType=tmpO_.authtype||_authCfg.authtype,_host=tmpO_.host||ws_.host,_list=tmpO_.list||ws_.list,_isTmp=!!tmpO_.istemp,_curToken=void 0,_tokenStorageKey="KKE_TOKEN$"+(_authType||""),_phpErrCount=0,_gotFromPhpApp=function(result_){if(!result_&&++_phpErrCount<3)return _authCfg.ondebug("error from php, retry..."+_phpErrCount),void _onlineAuth();var code=(result_=result_||{data:{}}).data.code||0,token=result_.data.token||null,timeout=result_.data.token_expire_time||NaN;result_.status&&1==code&&token&&!isNaN(timeout)?(_updateToken(token),_authDone(1e3*timeout),_authCfg.onToken(code),_phpErrCount=0):_onErr(result_)};function _loadToken(){_authCfg.ondebug("loading token from server...");var URL_PHP_AUTH="https://app.finance.sina.com.cn/auth/level2/auth?list=$list&product=$type&device_id=$device_id&ip=$ip&model=$model&_=$rn&__jsonp=1&callback=$cb";ws_.cfg.isKick&&(URL_PHP_AUTH="https://app.finance.sina.com.cn/auth/level2/kick?product=$type",ws_.cfg.isKick=!1);var type=_authType||"",randomFuncName="KKE_auth_"+genRandomStr();window[randomFuncName]=function(_){_gotFromPhpApp(_)},getScript(URL_PHP_AUTH.replace("$ip",_client_ip).replace("$type",type).replace("$cb",randomFuncName).replace("$rn",String(Math.random())).replace("$list",_list).replace("$device_id","test"),null,_gotFromPhpApp)}function _onlineAuth(){_authCfg.ondebug("loading ipaddr...");getScript(["http",_authCfg.ssl?"s":"","://",_host,"/?_=$rn&list=$symbol"].join("").replace("$rn",String((new Date).getTime())).replace("$symbol","sys_clientip"),function(){_client_ip=window.hq_str_sys_clientip,_loadToken()})}this.stopAuthRe=_stop,this.getToken=function(){return _curToken},this.setList=function(str_){_list=str_},this.auth=function(opt_){_authType&&(opt_=merge({forceOnline:!1,cb:null,noIp:!1},opt_||{}),isFunc(opt_.cb)?_callback=opt_.cb:isFunc(_callback)||(_callback=ws_.init),opt_.forceOnline?opt_.noIp&&_client_ip?(_authCfg.ondebug("existing client ip:"+_client_ip),_loadToken()):_onlineAuth():_loadLocalToken(),_stop())}}function log(log){window.console&&window.console.log&&console.log(log)}function addEvent(obj,type,call){obj.addEventListener?obj.addEventListener(type,call,!1):obj.attachEvent("on"+type,call)}function getHashCode(str,caseSensitive){for(var hash=1315423911,i=(str=!caseSensitive?str.toLowerCase():str).length;i--;)hash^=(hash<<5)+str.charCodeAt(i)+(hash>>2);return 2147483647&hash}function merge(argDestination,argOrigin){for(var p in argOrigin)argOrigin.hasOwnProperty(p)&&("object"==typeof argDestination[p]&&"object"==typeof argOrigin[p]?argDestination[p]=arguments.callee(argOrigin[p],argDestination[p]):argDestination[p]=argOrigin[p]);return argDestination}function fBind(f_,obj_,var_args_){var arr=Array.prototype.slice.call(arguments,2);return function(var_args__){return f_.apply(obj_,arr.concat(Array.prototype.slice.call(arguments)))}}function fnBind(fn,argObj,args){return function(){if(args&&arguments.length)for(var _args=Array.prototype.slice.call(args,0),i=0;i<arguments.length;i++)Array.prototype.push.call(_args,arguments[i]);return fn.apply(argObj||this,_args||args||arguments)}}function getScript(argUrl,argCallback,errCb_,argCharset){var _script=document.createElement("script");_script.type="text/javascript",argCharset&&(_script.charset=argCharset),_script.src=argUrl;var _head=document.getElementsByTagName("head")[0],_done=!1;_script.onload=_script.onreadystatechange=function(){_done||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(_done=!0,argCallback&&setTimeout(argCallback,1),_script.onload=_script.onreadystatechange=null,setTimeout(function(){_head.removeChild(_script)},1))},_script.onerror=function(){_script.onload=_script.onreadystatechange=_script.onerror=null,_script.parentNode.removeChild(_script),_script=null,"function"==typeof errCb_&&errCb_()},setTimeout(function(){_head.appendChild(_script)},1)}function isType(type){return function(obj){return{}.toString.call(obj)=="[object "+type+"]"}}function codeConvert(code_){for(var hex=code_.toString(16);hex.length<2;)hex="0"+hex;return 1}function genRandomStr(len_){len_=len_||9;for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890",str="",i=0,l=chars.length;i<len_;i++)str+=chars.charAt(Math.floor(Math.random()*l));return str}IO.WebPush4||(IO.WebPush4=function(host_,list,onMsg_,cfg_){if(host_=host_.match(/(\w*:\/\/)?([^\/]+)(\/+.*)?/i)[2],this.id="ws_"+getHashCode(host_+list),this.host=host_||"hq.sinajs.cn",this.list=(list+"").split(","),this.onmessage=onMsg_,cfg_&&isNaN(cfg_.retryinterval))switch(this.host.split(".")[0]){case"live":case"wslive":cfg_.retryinterval=20;break;case"newspush":cfg_.retryinterval=39}this.cfg=merge({interval:3,retryinterval:0,allowrepeat:!1,nxkeyvalue:void 0,hidesyskey:!0,format:"",local:!1,ondebug:function(){},onMode:function(mode){},onToken:function(){},ishttp:!1,ssl:!1,ispmd:!1,authlocal:!1,authtype:void 0,onerr:function(obj_){},isKick:!1},cfg_||{}),this.cfg.interval<=0&&(this.cfg.interval=1,log("set refresh interval to 1s")),this.cfg.retryinterval<0&&(this.cfg.retryinterval=0,log("set retry interval to 0")),_sslM.get()&&(this.cfg.ssl=!0),this.cfg.ssl||"newspush.sinajs.cn"===this.host&&(this.cfg.ssl=!0),this.isAuth=!1,this.authFailCount=0,this.authMgr=void 0,this.cfg.authtype&&""!=this.cfg.authtype?this.authInit():this.init()},merge(IO.WebPush4.prototype,{VER:"4.6.6",CONTACT:"wangxuan2@staff.sina.com.cn,yangwen@staff.sina.com.cn,dapeng1@staff.sina.com.cn",MODE_NATIVE:"native",MODE_FLASH:"flash",MODE_JS:"js",socket:void 0,connection:void 0,localConn:void 0,mode:void 0,authReId:void 0,hasInit:!1,lastData:{},closeTimes:0,maxRetryTimes:3,RESET_SIGN:"=",RENEW_SIGN:"*",ONCE_SIGN:"?",ONCE_AUTH_SIGN:".",resymbols:function(newsymbols){!newsymbols||newsymbols.length<1||this.connection&&(1==this.connection.readyState?(this.list=(newsymbols+"").split(","),newsymbols="="+newsymbols,this.cfg.ondebug("new keys:"+this.list),this.connection.send(newsymbols)):this.cfg.ondebug("websocket connection is not available"))},resetlist:function(authtype){var sbs,_self;this.connection&&(!(sbs=(authtype=authtype||{}).list)||sbs.length<1||(1==(_self=this).connection.readyState?(authtype=authtype.authtype,this.list=(sbs+"").split(","),this.cfg.ondebug("keys change to:"+this.list+", and auth type: "+authtype),authtype?(this.cfg.authtype=authtype,this.isAuth=!0,this.authMgr||(this.authMgr=new AuthMgr(this)),this.authMgr.setList(sbs),this.authMgr.auth({forceOnline:!0,cb:function(){var cmd=[_self.RESET_SIGN,sbs,"\n",_self.RENEW_SIGN,_self.authMgr.getToken()].join("");_self.connection.send(cmd)},noIp:!1})):(this.cfg.authtype=void 0,this.isAuth=!1,clearInterval(this.authReId),this.connection.send([this.RESET_SIGN,sbs].join("")))):this.cfg.ondebug("websocket connection is not available")))},arequest:function(authtype){var sbs,_self,tmpAuthMgr;this.connection&&(!(sbs=(authtype=authtype||{}).list)||sbs.length<1||(1==(_self=this).connection.readyState?(authtype=authtype.authtype,this.cfg.ondebug(["query keys for once:",sbs,"and auth type:",authtype].join(" ")),authtype?(tmpAuthMgr=new AuthMgr(this,{istemp:!0,list:sbs,authtype:authtype})).auth({forceOnline:!0,cb:function(){var cmd=[_self.ONCE_SIGN,sbs,"\n",_self.ONCE_AUTH_SIGN,tmpAuthMgr.getToken()].join("");_self.connection.send(cmd)},noIp:!1}):this.connection.send([this.ONCE_SIGN,sbs].join(""))):this.cfg.ondebug("websocket connection is not available")))},authInit:function(){this.isAuth=!0,this.cfg.local=this.cfg.authlocal,this.authMgr=new AuthMgr(this),this.authMgr.auth()},init:function(){if(!this.hasInit){if(!(this.tryNative()||this.tryFlash()||this.tryJS()))return this.tryInitLater(),!1;this.hasInit=!0,(this.tryNative()||this.tryFlash())&&(this.cfg.local?this.createLocalConn():this.subscribe())}},tryInitLater:function(){setTimeout(fnBind(this.init,this),100)},createLocalConn:function(){this.cfg.ondebug("use Local-Conn");var _this=this;this.localConn=new IO.LocalConn4({key:this.id,ssl:this.cfg.ssl,onmessage:function(data){_this.listen(data)},onchange:function(){_this.subscribe()}})},disAndConn:function(){this.cfg.ondebug("disconnect aotumatically and reconnect with the new token"),this.retryClose(),this.subscribe()},renewalWithNewToken:function(msg){this.mode!=this.MODE_JS?(this.cfg.ondebug("try to renew the connection with "+(msg?"exiting":"new")+" token"),1==this.connection.readyState?this.authMgr?(msg=this.RENEW_SIGN+this.authMgr.getToken(),this.connection.send(msg)):this.cfg.ondebug("cannot get token, should not be auth mode"):(this.cfg.ondebug("readyState error, try to reconnect..."),this.disAndConn())):this.cfg.ondebug("detected js mode, no need to renew the socket connect")},setReTimeout:function(timeout_){var _self;this.cfg.ondebug("receiving timeout(ms):"+timeout_),isNaN(timeout_)||(clearInterval(this.authReId),0!=timeout_&&(timeout_-=1e3*Math.floor(5*Math.random()+2),this.cfg.ondebug("set timeout(ms):"+timeout_),(_self=this).authReId=setInterval(function(){_self.cfg.ondebug("timeup"),_self.authMgr&&_self.authMgr.auth({cb:_self.renewalWithNewToken,forceOnline:!0,noIp:!0})},timeout_)))},subscribe:function(){},receive:function(){},close:function(){},onClose:function(){},retryClose:function(){},listen:function(data){if(data){for(var _messages=data.match(/^[\s\S]+?$/gm),_data={},_format=this.cfg.format,_nxKeyValue=this.cfg.nxkeyvalue,_hideSysKey=this.cfg.hidesyskey,_hasData=!1,_self=this,msg,i=0,l=_messages.length;i<l;i++){if(msg=_messages[i],/^sys_/.test(msg)){if(_nxKeyValue&&0==msg.indexOf("sys_nxkey="))for(var nxArr=msg.split("="),keyArr=nxArr[1].split(","),j=keyArr.length;j--;)_makeKV(msg,keyArr[j],_nxKeyValue);if(_hideSysKey)continue}_messages[i].replace(/([^=]*)=([\s\S]*)/,_makeKV)}_hasData&&(this.onmessage(_data),this.authFailCount=0)}function _makeKV($0,$1,$2){var d;try{d="json"==_format?eval("("+$2+")"):$2}catch(e){}d&&(_self.lastData[$1]=_self.lastData[$1]||null,_self.lastData[$1]===d?_self.cfg.allowrepeat&&(_data[$1]=d,_hasData=!0):(_data[$1]=_self.lastData[$1]=d,_hasData=!0))}},retry:function(){this.retryClose(),this.cfg.ondebug("retrying..."),this.isAuth?this.authMgr.auth({cb:fnBind(this.subscribe,this),forceOnline:!0}):this.subscribe()},checkOnSysErr:function(data_,pre_){if(data_&&0<=data_.indexOf("sys_auth=")){if(pre_&&(window[pre_+"sys_auth"]=null),0<data_.indexOf("FAILED"))return this.cfg.ondebug("receive FAILED from server"),(this.isAuth?2<++this.authFailCount:9<++this.authFailCount)?(this.cfg.ondebug("too many retries for FAILED, stop and disconnect"),this.close(),this.authFailCount=0,this.cfg.onerr({msg_code:-3,result:"too many retries for FAILED"})):this.retry(),!0;if(0<data_.indexOf("INVALID"))return this.cfg.ondebug("receive INVALID from server"),this.isAuth?5<++this.authFailCount?(this.cfg.ondebug("too many retries for FAILED, renew the token"),this.retry()):this.renewalWithNewToken(!0):this.cfg.ondebug("ignore INVALID for non auth mode"),!0;0<data_.indexOf("SUCCEED")&&this.cfg.ondebug("successfully renewed")}return!1},tryNative:function(){return!this.cfg.ishttp&&(this.cfg.ondebug("try Native WebSocket service"),checkNative()?(this.nativeOK(),this.tryNative=function(){return!0},!0):!(this.tryNative=function(){return!1}))},nativeOK:function(){this.cfg.ondebug("Native WebSocket service is available"),this.mode=this.MODE_NATIVE,this.cfg.onMode(this.MODE_NATIVE),this.socket=WebSocket,this.subscribe=this.subScribeNative,this.receive=this.receiveNative,this.close=this.closeNative,this.onClose=this.onCloseNative,this.retryClose=this.retryCloseNative},subScribeNative:function(){this.cfg.ondebug(["master:try to connect and run,","Auth mode:",this.isAuth,"Secure:",this.cfg.ssl,"Permessage Deflate:",this.cfg.ispmd].join(" "));var url=[this.cfg.ssl?"wss":"ws","://",this.host,"/wskt"].join("");if(this.cfg.ispmd&&(url+=".pmd"),url+="?",this.isAuth&&(url+="token="+this.authMgr.getToken()+"&"),url+="list="+this.list.join(","),this.connection=new this.socket(url),!this.socket.isNotNative&&!this.connection.binaryType)return this.cfg.ondebug("illegal WebSocket"),this.connection.close(),void this.tryJS(!0);var _this=this;this.connection.toLongToConnectTimer=setTimeout(function(){_this.cfg.ondebug("nothing received from the server for a long time, try to close the connection...");try{_this.connection.close()}catch(e){_this.cfg.ondebug("close connection err")}},4e3),this.connection.onopen=function(){_this.resetCloseTimesTimer=setTimeout(function(){_this.cfg.ondebug("receiving data correctly, clear error count from "+_this.closeTimes+" to 0"),_this.closeTimes=0},6e4)},this.connection.refresher=setInterval(function(){1==_this.connection.readyState&&_this.connection.send("")},6e4),this.connection.onmessage=fnBind(this.receive,this),this.connection.onclose=fnBind(this.onClose,this),this.connection.onerror=function(){_this.mode==_this.MODE_FLASH&&(_this.cfg.ondebug("flash error, close and retry..."),_this.onClose())}},parseData:function(data_){this.checkOnSysErr(data_)||(this.cfg.local?this.localConn&&(this.cfg.nxkeyvalue?this.localConn.sendc(data_):this.localConn.sendc(data_.replace(/^sys_[\s\S]*?$(\r|\n)/gm,""))):this.cfg.nxkeyvalue?this.listen(data_):this.listen(data_.replace(/^sys_[\s\S]*?$(\r|\n)/gm,"")))},receiveNative:function(data){this.connection&&clearTimeout(this.connection.toLongToConnectTimer);data=data.data;this.parseData(data)},retryCloseNative:function(){clearInterval(this.authReId),this.isAuth&&this.authMgr.stopAuthRe(),this.connection&&(clearInterval(this.connection.refresher),this.connection.refresher=this.connection.onmessage=this.connection.onclose=null,this.connection.close(),this.connection=null)},closeNative:function(){this.localConn&&this.localConn.close(),this.localConn=null,this.socket=null,this.receive=null,this.subscribe=function(){},this.connection&&(clearInterval(this.connection.refresher),this.connection.onclose=function(){},this.connection.close(),this.connection=null),this.isAuth&&this.authMgr.stopAuthRe(),clearInterval(this.authReId)},onCloseNative:function(){if(clearTimeout(this.resetCloseTimesTimer),this.closeTimes++,this.cfg.ondebug("socket disconnected for "+this.closeTimes+" time(s)"),clearInterval(this.connection.refresher),this.connection.refresher=this.connection.onmessage=this.connection.onclose=null,this.connection=null,this.closeTimes>this.maxRetryTimes)return this.cfg.ondebug("too many retries, switch to JS mode"),void this.tryJS(!0);setTimeout(fnBind(this.subscribe,this),1e3*this.cfg.retryinterval)},__gotPhpUa:function(){if(!__phpUA){var phpUa=String(window[_PHP_UA_VAR]||"");try{this.cfg.ondebug("php ua to flash:"+phpUa),WebSocket.__flash.setUA(phpUa)}catch(e){this.cfg.ondebug("[err]php ua to flash:"+phpUa)}__phpUA=phpUa}},setStaticFlashUa:function(){try{WebSocket.__flash.setUA("hoshijiro")}catch(e){this.cfg.ondebug("error while calling Flash API:setUA")}},flashOK:function(){this.cfg.ondebug("flash component is available"),this.mode=this.MODE_FLASH,this.cfg.onMode(this.MODE_FLASH),this.socket=WebSocket,this.subscribe=this.subScribeNative,this.receive=this.receiveNative,this.close=this.closeNative,this.onClose=this.onCloseNative,this.retryClose=this.retryCloseNative},flashTryLimits:5,tryFlash:function(){return!this.cfg.ishttp&&(this.flashTryLimits--<0?!(this.cfg.ishttp=!0):(this.cfg.ondebug("try Flash mode, or waiting for Flash component responses"),WebSocket.flashOK?(this.isAuth&&this.setStaticFlashUa(),this.flashOK(),this.tryFlash=function(){return!0},!0):(WebSocket.canUse||(this.tryFlash=function(){return!1}),!1)))},httpLoadHq:void 0,tryJS:function(compel_){return this.cfg.ishttp&&(compel_=!0),!(WebSocket.canUse&&!compel_)&&(this.httpLoadHq||(this.httpLoadHq=new JsLoadHqM({ssl:this.cfg.ssl,host:this.host})),this.jsHQOK(),!0)},jsHQOK:function(){this.cfg.ondebug("use JS mode"),this.mode=this.MODE_JS,this.cfg.onMode(this.MODE_JS),this.tryJS=function(){return!0},this.subscribe=this.subScribeJS,this.receive=this.receiveJS,this.close=this.closeJS,this.retryClose=this.retryCloseJs,this.subscribe()},subScribeJS:function(){function _load(){var opt={domain:_self.host,type:_self.cfg.format};_self.isAuth&&(opt.others="&token="+_self.authMgr.getToken()),_self.httpLoadHq(_self.list,fBind(_self.receive,_self),opt)}var _self=this;_load(),this.connection=setInterval(_load,1e3*this.cfg.interval)},receiveJS:function(){var _data={},_pre="json"==this.cfg.format?"hq_json_":"hq_str_";if(!this.checkOnSysErr(window[_pre+"sys_auth"],_pre)){for(var _hasData,i=0,l=this.list.length;i<l;i++)this.lastData[this.list[i]]!==window[_pre+this.list[i]]&&(this.lastData[this.list[i]]=_data[this.list[i]]=window[_pre+this.list[i]],_hasData=!0);_hasData&&(this.onmessage(_data),this.authFailCount=0)}},closeJS:function(){this.subscribe=function(){},this.localConn&&this.localConn.close(),this.localConn=null,clearInterval(this.connection),this.isAuth&&this.authMgr.stopAuthRe(),clearInterval(this.authReId)},retryCloseJs:function(){clearInterval(this.authReId),clearInterval(this.connection),this.isAuth&&this.authMgr.stopAuthRe()}}),hasLs&&checkNative()?(_iframeID="IO_WEBPUSH4_LOCALCONN_IFRAME",proxy=void 0,IO.LocalConn4=function(cfg){var _this;_iframe||((_iframe=document.getElementById(_iframeID))||((_iframe=document.createElement("iframe")).id=_iframeID,_iframe.style.display="none",_iframe.src="//woocall.sina.com.cn/lib/iframe/IO.WebPush4.localConn.htm",document.body.insertBefore(_iframe,document.body.firstChild)),_pWin=_iframe.contentWindow,addEvent(window,"message",function(ev){"M OK now!"==ev.data&&(proxy={postMessage:function(data){_pWin.postMessage(data,"*")},listen:function(call){addEvent(window,"message",call)}})})),proxy?(this.id="lc"+Math.random(),this.id=this.id.replace("0.",""),this.cfg=merge({key:"",ssl:!1,onmessage:function(data){},onchange:function(type){}},cfg),_this=this,proxy.listen(function(ev){var _key,_data;if(ev.data&&isFunc(ev.data.indexOf)&&-1!=ev.data.indexOf(_this.id+":"))switch(ev.data.replace(/([^:]+):([\s\S]*)/,function(){_key=arguments[1],_data=arguments[2]}),_key){case"IO_LOCALCONN_ONCHANGE_"+_this.id:_this.onchange(_data);break;case"IO_LOCALCONN_ONMESSAGE_"+_this.id:_this.onmessage(_data)}}),proxy.postMessage(["newLocalConn(",this.cfg.key,",",this.id,")"].join(""))):setTimeout(fnBind(arguments.callee,this,arguments),100)},merge(IO.LocalConn4.prototype,{onchange:function(cmd){this.cfg.onchange&&this.cfg.onchange(cmd)},onmessage:function(data){this.cfg.onmessage&&this.cfg.onmessage(data)},sendc:function(data){data&&proxy.postMessage("IO_LOCALCONN_SEND_"+this.id+":"+data)},close:function(){proxy.postMessage("IO_LOCALCONN_CLOSE_"+this.id+":now!")}})):(IO.LocalConn4=function(cfg){this.cfg=merge({key:"",ssl:!1,onmessage:function(data){},onchange:function(type){}},cfg),IO.LocalConn4.flash={init:function(){}},IO.LocalConn4.prototype.sendc=function(data){this.onmessage(data)},this.onchange("master")},merge(IO.LocalConn4.prototype,{flashID:"localConnFlash",onchange:function(cmd){this.cfg.onchange&&this.cfg.onchange(cmd)},onmessage:function(data){this.cfg.onmessage&&this.cfg.onmessage(data)},sendc:function(data){data&&this.constructor.flash.sendc(this.id,data)},close:function(){}}),IO.LocalConn4.flash=!1,IO.LocalConn4.objs={},IO.LocalConn4.ready=function(){IO.LocalConn4.flash=document.localConnFlash||window.localConnFlash},IO.LocalConn4.onmessage=function(id,msg){this.objs[id].onmessage(msg)},IO.LocalConn4.onchange=function(id,status){this.objs[id].onchange(status)}))}();